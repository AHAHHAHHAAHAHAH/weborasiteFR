---
import type { SiteConfig } from "../lib/siteConfig";
const { cfg } = Astro.props as { cfg: SiteConfig };
---

<div id="drawerBackdrop" style="position:fixed; inset:0; background: rgba(0,0,0,.70); backdrop-filter: blur(6px); opacity:0; pointer-events:none; transition:opacity .3s ease; z-index:60;"></div>

<aside id="drawerPanel" class="card" style="
  position:fixed; top:16px; right:16px; width:min(380px, calc(100vw - 32px));
  transform: translateY(-10px) translateX(10px);
  opacity:0; pointer-events:none;
  transition: transform .4s cubic-bezier(0.16, 1, 0.3, 1), opacity .3s ease;
  z-index:61; overflow:hidden; background: var(--panel);">
  
  <div style="padding:24px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--line); background: rgba(255,255,255,.01);">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src={cfg.brand.logoPath} alt="Logo" style="height:26px; width:auto;" />
      <strong style="font-size:1.1rem; font-weight: 600;">{cfg.navigation.drawerTitle}</strong>
    </div>
    <button class="btn" id="closeDrawer" aria-label="Chiudi" style="padding:8px 12px; background:transparent; border:none; font-size:1.2rem; color:var(--muted);">âœ•</button>
  </div>

  <nav style="padding:20px 16px; display:flex; flex-direction:column; gap:10px; max-height:calc(100vh - 120px); overflow-y:auto;">
    <a class="btn" style="width:100%; justify-content:flex-start; padding:14px 20px; font-weight:500; font-size:1.05rem;"
       href="/" onclick="window.dispatchEvent(new CustomEvent('webora:drawer:close'))">
      Home
    </a>
    {cfg.navigation.items.map((i: any) => (
      <a class="btn" style="width:100%; justify-content:flex-start; padding:14px 20px; font-weight:500; font-size:1.05rem;"
         href={`/${i.id}`}
         onclick="window.dispatchEvent(new CustomEvent('webora:drawer:close'))">
        {i.label}
      </a>
    ))}
  </nav>
</aside>

<script type="module">
  const b = document.getElementById("drawerBackdrop");
  const p = document.getElementById("drawerPanel");
  const x = document.getElementById("closeDrawer");

  if (b && p && x) {
    function open() {
      b.style.opacity = "1";
      b.style.pointerEvents = "auto";
      p.style.opacity = "1";
      p.style.pointerEvents = "auto";
      p.style.transform = "translateY(0) translateX(0)";
    }

    function close() {
      b.style.opacity = "0";
      b.style.pointerEvents = "none";
      p.style.opacity = "0";
      p.style.pointerEvents = "none";
      p.style.transform = "translateY(-10px) translateX(10px)";
    }

    window.addEventListener("webora:drawer:open", open);
    window.addEventListener("webora:drawer:close", close);
    b.addEventListener("click", close);
    x.addEventListener("click", close);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") close();
    });
  }
</script>