---
import type { SiteConfig } from "../lib/siteConfig";
const { cfg } = Astro.props as { cfg: SiteConfig };

const cta = cfg.navigation.cta;
// Costruiamo il link assoluto eliminando cancelletti e slash indesiderati
const ctaHref = cta.type === "whatsapp" ? `https://wa.me/${cfg.contacts.phoneE164}` : `/${cta.targetId.replace('#','').replace('/','')}`;
---

<header style="position:fixed; top:24px; left:24px; right:24px; z-index:50; display:flex; justify-content:space-between; align-items:flex-start; pointer-events:none;">
  
  <a href="/" style="pointer-events:auto; display:flex; align-items:center; gap:16px; transition: transform 0.3s ease, opacity 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'; this.style.opacity='0.8'" onmouseout="this.style.transform='scale(1)'; this.style.opacity='1'">
    <img src={cfg.brand.logoPath} alt={cfg.brand.name} style="height:36px; width:auto; display:block;" />
    <div style="display:flex; flex-direction:column; line-height: 1.1;">
      <strong style="font-size:1.1rem; font-weight: 700; letter-spacing:0.02em; color: var(--text);">{cfg.brand.name}</strong>
      <span style="font-size: 0.75rem; color: var(--accent2); font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em;">Studio</span>
    </div>
  </a>

  <div style="display:flex; align-items:center; gap:16px; pointer-events:auto;">
    <a class="btn" style="padding: 12px 28px; font-size: 0.95rem; font-weight: 600; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08);" href={ctaHref} target={cta.type === "whatsapp" ? "_blank" : undefined}>
      {cta.label}
    </a>
    
    <button class="btn" id="openDrawer" aria-label="Menu" style="padding: 14px; border-radius: 50%; width: 54px; height: 54px; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08);">
      <span style="display:flex; flex-direction:column; gap:6px; width:22px; align-items:flex-end;">
        <span style="display:block; width:100%; height:2px; background:var(--text); border-radius:2px; transition: width 0.2s;"></span>
        <span style="display:block; width:70%; height:2px; background:var(--text); border-radius:2px; transition: width 0.2s;"></span>
      </span>
    </button>
  </div>

  <script>
    document.getElementById("openDrawer")?.addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("webora:drawer:open"));
    });
    // Piccola interazione hover sul bottone hamburger
    const btn = document.getElementById("openDrawer");
    btn?.addEventListener("mouseenter", () => {
      const lines = btn.querySelectorAll("span > span") as NodeListOf<HTMLElement>;
      if(lines[1]) lines[1].style.width = "100%";
    });
    btn?.addEventListener("mouseleave", () => {
      const lines = btn.querySelectorAll("span > span") as NodeListOf<HTMLElement>;
      if(lines[1]) lines[1].style.width = "70%";
    });
  </script>
</header>